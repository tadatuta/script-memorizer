<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            padding: 24px;
            font-size: 22px;
            line-height: 1.5;
            font-family: sans-serif;
        }

        div {
            margin-bottom: 12px;
        }

        #text {
            margin-bottom: 24px;
        }

        #before, #after {
            font-style: italic;
            font-size: 18px;
        }

        button {
            font-size: 28px;
        }
    </style>
</head>

<body>
    <div id="before"></div>
    <div id="text"></div>
    <div id="after"></div>
    <div><label><input id="sound" type="checkbox">Озвучивать</label></div>
    <div><button id="answer">Ответ</button></div>
    <div><button id="next">Далее</button></div>
    <script>
        const text = [
            {
                "character": "Женщина",
                "text": "Вы же сказали, что вы психолог."
            },
            {
                "character": "Мужчина",
                "text": "Я не говорил, что я психолог."
            },
            {
                "character": "Женщина",
                "text": "Что вы врете! Я вас спросила — «это вы психолог?» и вы сказали да."
            },
            {
                "character": "Мужчина",
                "text": "Я вам этого не говорил. Это вы сказали, что я психолог."
            },
            {
                "character": "Женщина",
                "text": "Тогда почему вы не сказали мне, что я ошиблась? Вы меня обманули."
            },
            {
                "character": "Мужчина",
                "text": "Ну вообще-то мы все в той или иной степени психологи. Если бы я сказал, что я не психолог, то это тоже было бы враньем. Согласитесь..."
            },
            {
                "character": "Женщина",
                "action": "Судорожно хватает листок и карандаш. Открывает сумочку, кладет туда карандаш. Пытается встать из-за стола."
            },
            {
                "character": "Мужчина",
                "text": "Вы куда?"
            },
            {
                "character": "Женщина",
                "text": "Я сейчас иду в администрацию и говорю, что один из сотрудников обманул меня, ввел в заблуждение, заставил рассказывать о себе интимные подробности и писать всякую ахинею на бумаге."
            },
            {
                "character": "Мужчина",
                "text": "Я не просил рассказывать мне никаких интимных подробностей. Успокойтесь, пожалуйста."
            },
            {
                "character": "Женщина",
                "text": "Не надо меня успокаивать. Вас отсюда уволят ко всем чертям, вот тогда я успокоюсь."
            },
            {
                "character": "Мужчина",
                "text": "Меня никто отсюда не уволит. Я здесь не работаю."
            },
            {
                "character": "Женщина",
                "action": "На мгновение замирает. Смотрит на мужчину."
            },
            {
                "character": "Женщина",
                "text": "Что значит не работаете? Вы вообще кто такой?"
            },
            {
                "character": "Мужчина",
                "text": "Ну вот. Вот! Наконец-то вы задали мне этот вопрос!"
            },
            {
                "character": "Женщина",
                "text": "Я вас спрашиваю, кто вы такой!",
                "action": "кричит"
            },
            {
                "character": "Мужчина",
                "text": "Не кричите. Я вас прошу, успокойтесь."
            },
            {
                "character": "Женщина",
                "text": "Кто вы такой?",
                "action": "кричит"
            },
            {
                "character": "Мужчина",
                "text": "Тарас."
            },
            {
                "character": "Женщина",
                "action": "Замирает"
            },
            {
                "character": "Женщина",
                "text": "Какой нахер Тарас! Что ты делаешь в этом кабинете?"
            },
            {
                "character": "Мужчина",
                "text": "Я здесь работаю."
            },
            {
                "character": "Женщина",
                "text": "Так, всё. Я иду в администрацию.",
                "action": "Вскакивает из-за стола. Срывается в сторону двери."
            },
            {
                "character": "Мужчина",
                "text": "Да в какую администрацию? Этот кабинет не принадлежит клинике. Здесь строительная фирма."
            },
            {
                "character": "Женщина",
                "text": "Строительная фирма? Как это строительная фирма? Почему вы мне сразу это не сказали?"
            },
            {
                "character": "Мужчина",
                "text": "А вы что, меня об этом спрашивали?"
            },
            {
                "character": "Женщина",
                "text": "Так, прекратите валять дурака. Вы сказали, что вы психолог."
            },
            {
                "character": "Мужчина",
                "text": "Я не говорил, что я психолог."
            },
            {
                "character": "Женщина",
                "text": "Да, что вы врете! Я вас спросила — «это вы психолог?». Вы ответили да."
            },
            {
                "character": "Мужчина",
                "text": "Девушка, мы начинаем с вами ходить по кругу. Это не я, это вы сказали, что я психолог."
            },
            {
                "character": "Женщина",
                "text": "Так почему вы мне не сказали, что вы не психолог, мать вашу, а какая-то гребаная строительная фирма!",
                "action": "Женщина подрывается назад к столу. Орет"
            },
            {
                "character": "Мужчина",
                "text": "Я вас очень прошу успокойтесь. Во-первых, мы не какая-то «гребаная строительная фирма», а строительная фирма «Путевка к счастью». А во-вторых, вы меня не спрашивали, строительная мы фирма или психологическая клиника."
            },
            {
                "character": "Женщина",
                "action": "Женщина изнеможенно стекает на стул. Руки кладет перед собой на стол."
            },
            {
                "character": "Женщина",
                "text": "Что вам от меня надо?",
                "action": "Обессилено"
            },
            {
                "character": "Мужчина",
                "text": "Что мне от вас надо!? Мне от вас ничего не надо. Это вы пришли ко мне."
            },
            {
                "character": "Женщина",
                "text": "Тогда отпустите меня. Я вас очень прошу."
            },
            {
                "character": "Мужчина",
                "text": "Так я вас и не держу. Вы можете в любой момент уйти."
            },
            {
                "character": "Женщина",
                "action": "Некоторое время сидит, пытаясь собраться с силами. Медленно встает из-за стола и двигается в сторону двери."
            },
            {
                "character": "Женщина",
                "text": "Спасибо."
            },
            {
                "character": "Мужчина",
                "text": "Мне просто казалось, что я могу вам помочь.",
                "action": "В спину"
            },
            {
                "character": "Женщина",
                "action": "С окончательно недоумевающим лицом поворачивается в дверном проеме."
            },
            {
                "character": "Женщина",
                "text": "Чем вы можете мне помочь? У меня муж мудак. Я вам полчаса об этом душу изливала. Я не знаю, что со всем этим делать. А вы-то чем можете тут помочь?"
            },
            {
                "character": "Мужчина",
                "text": "Ну как же! Вы же сказали, что у вас треснула раковина и горячий кран нельзя закрыть, что вздулся пол рядом с ванной комнатой, а муж шляется по каким-то другим бабам и в доме ничего не делает. Так мы можем помочь, это как раз в нашей компетенции. Я ж вас поэтому и просил все на листок бумаги записывать. Мы можем полностью и раковину и всю систему водоснабжения поменять. А также половое покрытие у нас сейчас с хорошей скидкой идет."
            },
            {
                "character": "Мужчина",
                "action": "Мужчина кладет перед Женщиной на стол визитку с надписью «Путевка к счастью» и телефонами."
            },
            {
                "character": "Женщина",
                "text": "Слушайте, вы... Половое покрытие... Идите на хуй.",
                "action": "Женщина смотрит на мужчину. Лицо ее абсолютно безэмоционально."
            }
        ];

        let i = -1;
        const textDiv = document.querySelector('#text');
        const beforeDiv = document.querySelector('#before');
        const afterDiv = document.querySelector('#after');
        const soundCheckbox = document.querySelector('#sound');
        textDiv.innerHTML = text[i];

        function init() {
            next();
        }

        init();

        function next(step = 1) {
            i += step;

            while(!text[i] || !text[i].text) {
                i++;
            }
            const prev = text[i - 1];
            const current = text[i];
            const next = text[i + 1];
            beforeDiv.innerHTML = '';
            afterDiv.innerHTML = '';

            if (prev && !prev.text && prev.action) {
                beforeDiv.innerHTML = prev.character + ': ' + prev.action;
            }
            if (current.action) {
                beforeDiv.innerHTML += (beforeDiv.innerHTML ? '<br>' : '') + current.character + ': ' + current.action;
            }

            if (next && !next.text && next.action) {
                console.log('next', next);
                afterDiv.innerHTML = next.character + ': ' + next.action;
            }
            textDiv.innerHTML = `<strong>${current.character}</strong><br>${current.text}`;
            soundCheckbox.checked && speak(current.text);
        }

        document.querySelector('#next').addEventListener('click', (e) => {
            next();
        });

        document.querySelector('#answer').addEventListener('click', (e) => {
            next(2);
        });

        let voices = window.speechSynthesis.getVoices();
        setTimeout(function () {
            voices = window.speechSynthesis.getVoices();
            voices = voices.filter(v => v.lang === 'ru-RU');
        }, 300);

        function speak(s) {
            if (!window.speechSynthesis) { return; }
            var utterance = new SpeechSynthesisUtterance(s);
            utterance.lang = 'ru-RU';
            utterance.voice = voices[i % 2];
            window.speechSynthesis.speak(utterance);
        };
    </script>
</body>

</html>
